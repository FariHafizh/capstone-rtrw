<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
</head>
<body>
  <h2 id="welcome"></h2>
  <button id="ajukanSuratBtn">Ajukan surat ke RT/RW</button>
  <button id="logoutBtn">Logout</button>

  <p id="message"></p>

  <script>
  async function checkSession() {
    try {
      const res = await fetch('/api/auth/check-session');
      if (!res.ok) throw new Error('Session tidak valid');
      const data = await res.json();
      document.getElementById('welcome').textContent = `Selamat datang, ${data.user.nama}!`;
    } catch {
      alert('Anda harus login terlebih dahulu.');
      window.location.href = '/login.html';
    }
  }

  checkSession();

  document.getElementById('ajukanSuratBtn').addEventListener('click', () => {
    window.location.href = '/ajukan-surat-rt-rw.html';
  });

  document.getElementById('logoutBtn').addEventListener('click', async () => {
    try {
      const res = await fetch('/api/auth/logout', { method: 'POST', headers: { 'Content-Type': 'application/json' }});
      const result = await res.json();
      document.getElementById('message').textContent = result.message;
      if (res.ok && result.redirect) {
        setTimeout(() => window.location.href = result.redirect, 1000);
      }
    } catch (err) {
      document.getElementById('message').textContent = 'Terjadi kesalahan saat logout: ' + err.message;
    }
  });
  </script>
</body>
</html>
